<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Student Violation Report Form</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <link rel="stylesheet" href="/css/sidebar.css">
  <link rel="stylesheet" href="/css/formdesign.css">
</head>

<body>
  <div class="container">
    <div class="form-container">
      <div class="header--wrapper">
        <div class="header--title">
          <span style="color: white;font-weight: bold; font-size: 20px">SASO-<span
              style="color: rgb(255, 255, 255)55, 255, 255);">IMS</span></span>
          <h2 style="color:white;">Student Violation Report Form</h2>
        </div>
        <div class="user--info">
          <img src="/lib/guidancelogo.png" alt="">
        </div>
      </div>

      <div class="row">
        <div class="col-md-12">
          <div class="form-group">
            <label for="searchStudent">Search for student:</label>
            <div class="input-group">
              <input type="text" class="form-control" id="searchStudent" name="searchStudent">
            </div>
          </div>
        </div>
      </div>

      <form id="violationForm">
        <div class="row">
          <div class="col-md-6">
            <div class="form-group">
              <label for="studentID">Student ID Number:</label>
              <input type="text" class="form-control" id="studentID" name="studentID" disabled>
            </div>
          </div>

          <div class="col-md-6">
            <div class="form-group">
              <label for="studentName">Student Name:</label>
              <input type="text" class="form-control" id="studentName" name="studentName" disabled>
            </div>
          </div>
        </div>

        <div class="row">
          <div class="col-md-6">
            <div class="form-group">
              <label for="departmentSelect" class="form-label">Department:</label>
              <input type="text" class="form-control" id="departmentSelect" name="departmentSelect" disabled>
            </div>
          </div>

          <div class="col-md-6">
            <div class="form-group">
              <label for="courseSelect" class="form-label">Course:</label>
              <input type="text" class="form-control" id="courseSelect" name="courseSelect" disabled>
            </div>
          </div>
        </div>

        <div class="row">
          <div class="col-md-6">
            <div class="form-group">
              <label for="academicYear">Academic Year:</label>
              <input type="text" class="form-control" id="academicYear" name="academicYear" disabled>
            </div>
          </div>
        </div>

        <div class="form-category">Violation Details</div>
        <div class="row">
          <div class="col-md-6">
            <div class="form-group">
              <label for="violationSelect">Select a violation:</label>
              <select class="form-control" id="violationSelect" required>
                <option value="">Select violation</option>
              </select>
            </div>
          </div>
          <div class="col-md-6">
            <div class="form-group">
              <label for="dateOfViolation">Date of Violation:</label>
              <input type="date" class="form-control" id="dateOfViolation" name="dateOfViolation" required>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-md-6">
            <!-- Violation Details Fields -->
            <div class="form-group">
              <label for="timeOfViolation">Time of Violation:</label>
              <input type="time" class="form-control" id="timeOfViolation" name="timeOfViolation" required>
            </div>
            <!-- Other Violation Details Fields -->
          </div>
          <div class="col-md-6">
            <div class="form-group">
              <label for="sanction">Sanction:</label>
              <select class="form-control" id="offenseLevelSelect" required>
                <option value="1st">1st offense</option>
                <option value="2nd">2nd Offense</option>
                <option value="3rd">3rd Offense</option>
                <option value="4th">4th Offense</option>
                <option value="5th">5th Offense</option>
                <option value="6th">6th Offense</option>
                <option value="7th">7th Offense</option>
                <option value="8th">8th Offense</option>
              </select>
            </div>
          </div>
        </div>
        <div class="form-group">
          <textarea class="form-control" id="disciplinaryActionInput" placeholder="Disciplinary Action" rows="4"
            required></textarea>
        </div>
        <div class="row">
          <div class="col-md-6">
            <div class="form-group">
              <label for="offenseType">Offense Type:</label>
              <select class="form-control" id="offenseType" name="offenseType">
                <option value="major">Major Offense</option>
                <option value="minor">Minor Offense</option>
              </select>
            </div>
          </div>
          <div class="col-md-6">
            <div class="form-group">
              <label for="location">Location of Violation:</label>
              <input type="text" class="form-control" id="location" name="location" required>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-md-12">
            <div class="form-group">
              <label for="description">Description of Violation:</label>
              <textarea class="form-control" id="description" name="description" rows="4" required></textarea>
            </div>
          </div>
        </div>
        <div class="form-category">Reporting Person's Information</div>
        <div class="row">
          <div class="col-md-6">
            <div class="form-group">
              <label for="reportingPersonName">Name:</label>
              <input type="text" class="form-control" id="reportingPersonName" name="reportingPersonName" required>
            </div>
          </div>
          <div class="col-md-6">
            <div class="form-group">
              <label for="role">Role or Position:</label>
              <input type="text" class="form-control" id="role" name="role" required>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-md-6">
            <div class="form-group">
              <label for="contactNumber">Contact Number:</label>
              <input type="number" id="contact" name="contact" required>
            </div>
          </div>

          <div class="col-md-6">
            <div class="form-group">
              <label for="approvalStatus">Approval Status:</label>
              <div class="form-check">
                <input type="radio" class="form-check-input" id="pendingStatus" name="approvalStatus" value="pending"
                  required>
                <label class="form-check-label" for="pendingStatus">Pending</label>
              </div>
              <div class="form-check">
                <input type="radio" class="form-check-input" id="ongoingStatus" name="approvalStatus" value="ongoing"
                  required>
                <label class="form-check-label" for="ongoingStatus">Ongoing</label>
              </div>
              <div class="form-check">
                <input type="radio" class="form-check-input" id="resolvedStatus" name="approvalStatus" value="resolved"
                  required>
                <label class="form-check-label" for="resolvedStatus">Resolved</label>
              </div>
            </div>
          </div>
        </div>

        <div class="form-group text-right">
          <button type="submit" id="" class="btn btn-primary">Submit</button>
        </div>
      </form>
    </div>
  </div>

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
  <script src="~/js/addviolation.js"></script>

  <script>
    jQuery(document).ready(function ($) {
      $("#searchStudent").autocomplete({
        source: function (request, response) {
          $.ajax({
            url: "/api/studentregister/autocomplete",
            type: "GET",
            data: {
              searchTerm: request.term
            },
            success: function (data) {
              console.log(data);

              // Check if data is an array
              if (Array.isArray(data)) {
                response($.map(data, function (item) {
                  console.log(item);

                  // Check if expected properties exist
                  if (item.firstname && item.middlename && item.lastname) {
                    return {
                      label: item.firstname + ' ' + item.middlename + ' ' + item.lastname,
                      value: item.firstname + ' ' + item.middlename + ' ' + item.lastname,
                      studentData: item
                    };
                  } else {
                    console.error("Invalid data format for item:", item);
                    return null;
                  }
                }));
              } else {
                console.error("Invalid response format. Expected an array.");
              }
            },
            error: function (xhr, status, error) {
              console.error("AJAX Error:", status, error);
            }
          });
        },
        minLength: 2,
        select: function (event, ui) {
          var fullName = ui.item.studentData.firstname + ' ' + ui.item.studentData.middlename + ' ' + ui.item.studentData.lastname;
          $("#studentName").val(fullName);
          $("#studentID").val(ui.item.studentData.studentIdNum);
          $("#departmentSelect").val(ui.item.studentData.department);
          $("#courseSelect").val(ui.item.studentData.course);
          $("#academicYear").val(ui.item.studentData.academicYear);
        }
      });

    });


    document.addEventListener("DOMContentLoaded", function() {
  // Event listeners for changes in violation type and offense level
  document.getElementById("violationSelect").addEventListener("change", updateDisciplinaryAction);
  document.getElementById("offenseLevelSelect").addEventListener("change", updateDisciplinaryAction);

  // Populate violation options on page load
  populateViolationOptions();
});

function populateViolationOptions() {
  fetch("/api/Violation/getAllViolations")
      .then(response => {
          if (!response.ok) {
              throw new Error('Network response was not ok');
          }
          return response.json();
      })
      .then(data => {
          console.log("Fetched violations:", data);
          const selectElement = document.getElementById("violationSelect");
          data.forEach(violation => {
              console.log("Processing violation:", violation);
              const option = document.createElement("option");
              option.value = violation.id;
              option.textContent = violation.violationName;
              selectElement.appendChild(option);
          });
      })
      .catch(error => {
          console.error('Error fetching violations:', error);
      });
}
  </script>
  <script src="~/js/logout.js"></script>
</body>

</html>
